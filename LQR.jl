using ModelingToolkit, DifferentialEquations
using Plots
using Symbolics
using SciMLStructures:Tunable, replace, replace!
using SymbolicIndexingInterface: parameter_values, state_values
using ModelingToolkit: Nonnumeric
using LinearAlgebra, ControlSystems
include("./DP.jl")

begin
    def linearize(self, q, u):
        """
        Same as Linearize but simplified for a single (q, u) pair.

        q: array state
        u: scalar effort

        """
        # Memoize
        sq1, cq1 = np.sin(q[1]), np.cos(q[1])
        sq2, cq2 = np.sin(q[2]), np.cos(q[2])
        sq12, cq12 = np.sin(q[1] - q[2]), np.cos(q[1] - q[2])

        # Analytical Jacobian
        return (np.array([[0, 0, 0, 1, 0, 0],
                          [0, 0, 0, 0, 1, 0],
                          [0, 0, 0, 0, 0, 1],
                          [0, (self.l1*self.l2*(-4*self.m[1] + 9*self.m[2]*cq12**2 - 12*self.m[2])*(-2*self.b[0]*q[3] + self.l1*self.m[1]*sq1*q[4]**2 + 2*self.l1*self.m[2]*sq1*q[4]**2 + self.l2*self.m[2]*sq2*q[5]**2 + 2*u) + 3*self.l1*(3*(self.m[1] + 2*self.m[2])*cq12*cq1 - 2*(self.m[1] + 3*self.m[2])*cq2)*(2*self.b[2]*q[5] + self.g*self.l2*self.m[2]*sq2 - self.l1*self.l2*self.m[2]*sq12*q[4]**2) + 3*self.l2*(3*self.m[2]*cq12*cq2 - 2*(self.m[1] + 2*self.m[2])*cq1)*(2*self.b[1]*q[4] + self.g*self.l1*self.m[1]*sq1 + 2*self.g*self.l1*self.m[2]*sq1 + self.l1*self.l2*self.m[2]*sq12*q[5]**2))*(-9*self.m[2]*(self.m[1] + 2*self.m[2])*sq12*cq1*cq2 - 9*self.m[2]*(self.m[1] + 2*self.m[2])*sq1*cq12*cq2 + 18*self.m[2]*(self.m[0] + self.m[1] + self.m[2])*sq12*cq12 + 6*(self.m[1] + 2*self.m[2])**2*sq1*cq1)/(2*self.l1*self.l2*(-9*self.m[2]*(self.m[1] + 2*self.m[2])*cq12*cq1*cq2 + 3*self.m[2]*(self.m[1] + 3*self.m[2])*cq2**2 + 9*self.m[2]*(self.m[0] + self.m[1] + self.m[2])*cq12**2 + 3*(self.m[1] + 2*self.m[2])**2*cq1**2 - 4*(self.m[1] + 3*self.m[2])*(self.m[0] + self.m[1] + self.m[2]))**2) + (-3*self.l1**2*self.l2*self.m[2]*(3*(self.m[1] + 2*self.m[2])*cq12*cq1 - 2*(self.m[1] + 3*self.m[2])*cq2)*cq12*q[4]**2 - 18*self.l1*self.l2*self.m[2]*(-2*self.b[0]*q[3] + self.l1*self.m[1]*sq1*q[4]**2 + 2*self.l1*self.m[2]*sq1*q[4]**2 + self.l2*self.m[2]*sq2*q[5]**2 + 2*u)*sq12*cq12 + self.l1*self.l2*(self.l1*self.m[1]*cq1*q[4]**2 + 2*self.l1*self.m[2]*cq1*q[4]**2)*(-4*self.m[1] + 9*self.m[2]*cq12**2 - 12*self.m[2]) + 3*self.l1*(-3*(self.m[1] + 2*self.m[2])*sq12*cq1 - 3*(self.m[1] + 2*self.m[2])*sq1*cq12)*(2*self.b[2]*q[5] + self.g*self.l2*self.m[2]*sq2 - self.l1*self.l2*self.m[2]*sq12*q[4]**2) + 3*self.l2*(-3*self.m[2]*sq12*cq2 + 2*(self.m[1] + 2*self.m[2])*sq1)*(2*self.b[1]*q[4] + self.g*self.l1*self.m[1]*sq1 + 2*self.g*self.l1*self.m[2]*sq1 + self.l1*self.l2*self.m[2]*sq12*q[5]**2) + 3*self.l2*(3*self.m[2]*cq12*cq2 - 2*(self.m[1] + 2*self.m[2])*cq1)*(self.g*self.l1*self.m[1]*cq1 + 2*self.g*self.l1*self.m[2]*cq1 + self.l1*self.l2*self.m[2]*cq12*q[5]**2))/(2*self.l1*self.l2*(-9*self.m[2]*(self.m[1] + 2*self.m[2])*cq12*cq1*cq2 + 3*self.m[2]*(self.m[1] + 3*self.m[2])*cq2**2 + 9*self.m[2]*(self.m[0] + self.m[1] + self.m[2])*cq12**2 + 3*(self.m[1] + 2*self.m[2])**2*cq1**2 - 4*(self.m[1] + 3*self.m[2])*(self.m[0] + self.m[1] + self.m[2]))), (self.l1*self.l2*(-4*self.m[1] + 9*self.m[2]*cq12**2 - 12*self.m[2])*(-2*self.b[0]*q[3] + self.l1*self.m[1]*sq1*q[4]**2 + 2*self.l1*self.m[2]*sq1*q[4]**2 + self.l2*self.m[2]*sq2*q[5]**2 + 2*u) + 3*self.l1*(3*(self.m[1] + 2*self.m[2])*cq12*cq1 - 2*(self.m[1] + 3*self.m[2])*cq2)*(2*self.b[2]*q[5] + self.g*self.l2*self.m[2]*sq2 - self.l1*self.l2*self.m[2]*sq12*q[4]**2) + 3*self.l2*(3*self.m[2]*cq12*cq2 - 2*(self.m[1] + 2*self.m[2])*cq1)*(2*self.b[1]*q[4] + self.g*self.l1*self.m[1]*sq1 + 2*self.g*self.l1*self.m[2]*sq1 + self.l1*self.l2*self.m[2]*sq12*q[5]**2))*(9*self.m[2]*(self.m[1] + 2*self.m[2])*sq12*cq1*cq2 - 9*self.m[2]*(self.m[1] + 2*self.m[2])*sq2*cq12*cq1 + 6*self.m[2]*(self.m[1] + 3*self.m[2])*sq2*cq2 - 18*self.m[2]*(self.m[0] + self.m[1] + self.m[2])*sq12*cq12)/(2*self.l1*self.l2*(-9*self.m[2]*(self.m[1] + 2*self.m[2])*cq12*cq1*cq2 + 3*self.m[2]*(self.m[1] + 3*self.m[2])*cq2**2 + 9*self.m[2]*(self.m[0] + self.m[1] + self.m[2])*cq12**2 + 3*(self.m[1] + 2*self.m[2])**2*cq1**2 - 4*(self.m[1] + 3*self.m[2])*(self.m[0] + self.m[1] + self.m[2]))**2) + (-3*self.l1*self.l2**2*self.m[2]*(3*self.m[2]*cq12*cq2 - 2*(self.m[1] + 2*self.m[2])*cq1)*cq12*q[5]**2 + self.l1*self.l2**2*self.m[2]*(-4*self.m[1] + 9*self.m[2]*cq12**2 - 12*self.m[2])*cq2*q[5]**2 + 18*self.l1*self.l2*self.m[2]*(-2*self.b[0]*q[3] + self.l1*self.m[1]*sq1*q[4]**2 + 2*self.l1*self.m[2]*sq1*q[4]**2 + self.l2*self.m[2]*sq2*q[5]**2 + 2*u)*sq12*cq12 + 3*self.l1*(3*(self.m[1] + 2*self.m[2])*sq12*cq1 + 2*(self.m[1] + 3*self.m[2])*sq2)*(2*self.b[2]*q[5] + self.g*self.l2*self.m[2]*sq2 - self.l1*self.l2*self.m[2]*sq12*q[4]**2) + 3*self.l1*(3*(self.m[1] + 2*self.m[2])*cq12*cq1 - 2*(self.m[1] + 3*self.m[2])*cq2)*(self.g*self.l2*self.m[2]*cq2 + self.l1*self.l2*self.m[2]*cq12*q[4]**2) + 3*self.l2*(3*self.m[2]*sq12*cq2 - 3*self.m[2]*sq2*cq12)*(2*self.b[1]*q[4] + self.g*self.l1*self.m[1]*sq1 + 2*self.g*self.l1*self.m[2]*sq1 + self.l1*self.l2*self.m[2]*sq12*q[5]**2))/(2*self.l1*self.l2*(-9*self.m[2]*(self.m[1] + 2*self.m[2])*cq12*cq1*cq2 + 3*self.m[2]*(self.m[1] + 3*self.m[2])*cq2**2 + 9*self.m[2]*(self.m[0] + self.m[1] + self.m[2])*cq12**2 + 3*(self.m[1] + 2*self.m[2])**2*cq1**2 - 4*(self.m[1] + 3*self.m[2])*(self.m[0] + self.m[1] + self.m[2]))), -self.b[0]*(-4*self.m[1] + 9*self.m[2]*cq12**2 - 12*self.m[2])/(-9*self.m[2]*(self.m[1] + 2*self.m[2])*cq12*cq1*cq2 + 3*self.m[2]*(self.m[1] + 3*self.m[2])*cq2**2 + 9*self.m[2]*(self.m[0] + self.m[1] + self.m[2])*cq12**2 + 3*(self.m[1] + 2*self.m[2])**2*cq1**2 - 4*(self.m[1] + 3*self.m[2])*(self.m[0] + self.m[1] + self.m[2])), (6*self.b[1]*self.l2*(3*self.m[2]*cq12*cq2 - 2*(self.m[1] + 2*self.m[2])*cq1) - 6*self.l1**2*self.l2*self.m[2]*(3*(self.m[1] + 2*self.m[2])*cq12*cq1 - 2*(self.m[1] + 3*self.m[2])*cq2)*sq12*q[4] + self.l1*self.l2*(2*self.l1*self.m[1]*sq1*q[4] + 4*self.l1*self.m[2]*sq1*q[4])*(-4*self.m[1] + 9*self.m[2]*cq12**2 - 12*self.m[2]))/(2*self.l1*self.l2*(-9*self.m[2]*(self.m[1] + 2*self.m[2])*cq12*cq1*cq2 + 3*self.m[2]*(self.m[1] + 3*self.m[2])*cq2**2 + 9*self.m[2]*(self.m[0] + self.m[1] + self.m[2])*cq12**2 + 3*(self.m[1] + 2*self.m[2])**2*cq1**2 - 4*(self.m[1] + 3*self.m[2])*(self.m[0] + self.m[1] + self.m[2]))), (6*self.b[2]*self.l1*(3*(self.m[1] + 2*self.m[2])*cq12*cq1 - 2*(self.m[1] + 3*self.m[2])*cq2) + 6*self.l1*self.l2**2*self.m[2]*(3*self.m[2]*cq12*cq2 - 2*(self.m[1] + 2*self.m[2])*cq1)*sq12*q[5] + 2*self.l1*self.l2**2*self.m[2]*(-4*self.m[1] + 9*self.m[2]*cq12**2 - 12*self.m[2])*sq2*q[5])/(2*self.l1*self.l2*(-9*self.m[2]*(self.m[1] + 2*self.m[2])*cq12*cq1*cq2 + 3*self.m[2]*(self.m[1] + 3*self.m[2])*cq2**2 + 9*self.m[2]*(self.m[0] + self.m[1] + self.m[2])*cq12**2 + 3*(self.m[1] + 2*self.m[2])**2*cq1**2 - 4*(self.m[1] + 3*self.m[2])*(self.m[0] + self.m[1] + self.m[2])))],
                          [0, 3*(-self.l1*self.l2*(3*self.m[2]*cq12*cq2 - 2*(self.m[1] + 2*self.m[2])*cq1)*(-2*self.b[0]*q[3] + self.l1*self.m[1]*sq1*q[4]**2 + 2*self.l1*self.m[2]*sq1*q[4]**2 + self.l2*self.m[2]*sq2*q[5]**2 + 2*u) - 3*self.l1*(-(self.m[1] + 2*self.m[2])*cq1*cq2 + 2*(self.m[0] + self.m[1] + self.m[2])*cq12)*(2*self.b[2]*q[5] + self.g*self.l2*self.m[2]*sq2 - self.l1*self.l2*self.m[2]*sq12*q[4]**2) + self.l2*(4*self.m[0] + 4*self.m[1] + 3*self.m[2]*sq2**2 + self.m[2])*(2*self.b[1]*q[4] + self.g*self.l1*self.m[1]*sq1 + 2*self.g*self.l1*self.m[2]*sq1 + self.l1*self.l2*self.m[2]*sq12*q[5]**2))*(-9*self.m[2]*(self.m[1] + 2*self.m[2])*sq12*cq1*cq2 - 9*self.m[2]*(self.m[1] + 2*self.m[2])*sq1*cq12*cq2 + 18*self.m[2]*(self.m[0] + self.m[1] + self.m[2])*sq12*cq12 + 6*(self.m[1] + 2*self.m[2])**2*sq1*cq1)/(2*self.l1**2*self.l2*(-9*self.m[2]*(self.m[1] + 2*self.m[2])*cq12*cq1*cq2 + 3*self.m[2]*(self.m[1] + 3*self.m[2])*cq2**2 + 9*self.m[2]*(self.m[0] + self.m[1] + self.m[2])*cq12**2 + 3*(self.m[1] + 2*self.m[2])**2*cq1**2 - 4*(self.m[1] + 3*self.m[2])*(self.m[0] + self.m[1] + self.m[2]))**2) + 3*(3*self.l1**2*self.l2*self.m[2]*(-(self.m[1] + 2*self.m[2])*cq1*cq2 + 2*(self.m[0] + self.m[1] + self.m[2])*cq12)*cq12*q[4]**2 - self.l1*self.l2*(-3*self.m[2]*sq12*cq2 + 2*(self.m[1] + 2*self.m[2])*sq1)*(-2*self.b[0]*q[3] + self.l1*self.m[1]*sq1*q[4]**2 + 2*self.l1*self.m[2]*sq1*q[4]**2 + self.l2*self.m[2]*sq2*q[5]**2 + 2*u) - self.l1*self.l2*(3*self.m[2]*cq12*cq2 - 2*(self.m[1] + 2*self.m[2])*cq1)*(self.l1*self.m[1]*cq1*q[4]**2 + 2*self.l1*self.m[2]*cq1*q[4]**2) - 3*self.l1*((self.m[1] + 2*self.m[2])*sq1*cq2 - 2*(self.m[0] + self.m[1] + self.m[2])*sq12)*(2*self.b[2]*q[5] + self.g*self.l2*self.m[2]*sq2 - self.l1*self.l2*self.m[2]*sq12*q[4]**2) + self.l2*(self.g*self.l1*self.m[1]*cq1 + 2*self.g*self.l1*self.m[2]*cq1 + self.l1*self.l2*self.m[2]*cq12*q[5]**2)*(4*self.m[0] + 4*self.m[1] + 3*self.m[2]*sq2**2 + self.m[2]))/(2*self.l1**2*self.l2*(-9*self.m[2]*(self.m[1] + 2*self.m[2])*cq12*cq1*cq2 + 3*self.m[2]*(self.m[1] + 3*self.m[2])*cq2**2 + 9*self.m[2]*(self.m[0] + self.m[1] + self.m[2])*cq12**2 + 3*(self.m[1] + 2*self.m[2])**2*cq1**2 - 4*(self.m[1] + 3*self.m[2])*(self.m[0] + self.m[1] + self.m[2]))), 3*(-self.l1*self.l2*(3*self.m[2]*cq12*cq2 - 2*(self.m[1] + 2*self.m[2])*cq1)*(-2*self.b[0]*q[3] + self.l1*self.m[1]*sq1*q[4]**2 + 2*self.l1*self.m[2]*sq1*q[4]**2 + self.l2*self.m[2]*sq2*q[5]**2 + 2*u) - 3*self.l1*(-(self.m[1] + 2*self.m[2])*cq1*cq2 + 2*(self.m[0] + self.m[1] + self.m[2])*cq12)*(2*self.b[2]*q[5] + self.g*self.l2*self.m[2]*sq2 - self.l1*self.l2*self.m[2]*sq12*q[4]**2) + self.l2*(4*self.m[0] + 4*self.m[1] + 3*self.m[2]*sq2**2 + self.m[2])*(2*self.b[1]*q[4] + self.g*self.l1*self.m[1]*sq1 + 2*self.g*self.l1*self.m[2]*sq1 + self.l1*self.l2*self.m[2]*sq12*q[5]**2))*(9*self.m[2]*(self.m[1] + 2*self.m[2])*sq12*cq1*cq2 - 9*self.m[2]*(self.m[1] + 2*self.m[2])*sq2*cq12*cq1 + 6*self.m[2]*(self.m[1] + 3*self.m[2])*sq2*cq2 - 18*self.m[2]*(self.m[0] + self.m[1] + self.m[2])*sq12*cq12)/(2*self.l1**2*self.l2*(-9*self.m[2]*(self.m[1] + 2*self.m[2])*cq12*cq1*cq2 + 3*self.m[2]*(self.m[1] + 3*self.m[2])*cq2**2 + 9*self.m[2]*(self.m[0] + self.m[1] + self.m[2])*cq12**2 + 3*(self.m[1] + 2*self.m[2])**2*cq1**2 - 4*(self.m[1] + 3*self.m[2])*(self.m[0] + self.m[1] + self.m[2]))**2) + 3*(-self.l1*self.l2**2*self.m[2]*(3*self.m[2]*cq12*cq2 - 2*(self.m[1] + 2*self.m[2])*cq1)*cq2*q[5]**2 - self.l1*self.l2**2*self.m[2]*(4*self.m[0] + 4*self.m[1] + 3*self.m[2]*sq2**2 + self.m[2])*cq12*q[5]**2 - self.l1*self.l2*(3*self.m[2]*sq12*cq2 - 3*self.m[2]*sq2*cq12)*(-2*self.b[0]*q[3] + self.l1*self.m[1]*sq1*q[4]**2 + 2*self.l1*self.m[2]*sq1*q[4]**2 + self.l2*self.m[2]*sq2*q[5]**2 + 2*u) - 3*self.l1*((self.m[1] + 2*self.m[2])*sq2*cq1 + 2*(self.m[0] + self.m[1] + self.m[2])*sq12)*(2*self.b[2]*q[5] + self.g*self.l2*self.m[2]*sq2 - self.l1*self.l2*self.m[2]*sq12*q[4]**2) - 3*self.l1*(-(self.m[1] + 2*self.m[2])*cq1*cq2 + 2*(self.m[0] + self.m[1] + self.m[2])*cq12)*(self.g*self.l2*self.m[2]*cq2 + self.l1*self.l2*self.m[2]*cq12*q[4]**2) + 6*self.l2*self.m[2]*(2*self.b[1]*q[4] + self.g*self.l1*self.m[1]*sq1 + 2*self.g*self.l1*self.m[2]*sq1 + self.l1*self.l2*self.m[2]*sq12*q[5]**2)*sq2*cq2)/(2*self.l1**2*self.l2*(-9*self.m[2]*(self.m[1] + 2*self.m[2])*cq12*cq1*cq2 + 3*self.m[2]*(self.m[1] + 3*self.m[2])*cq2**2 + 9*self.m[2]*(self.m[0] + self.m[1] + self.m[2])*cq12**2 + 3*(self.m[1] + 2*self.m[2])**2*cq1**2 - 4*(self.m[1] + 3*self.m[2])*(self.m[0] + self.m[1] + self.m[2]))), 3*self.b[0]*(3*self.m[2]*cq12*cq2 - 2*(self.m[1] + 2*self.m[2])*cq1)/(self.l1*(-9*self.m[2]*(self.m[1] + 2*self.m[2])*cq12*cq1*cq2 + 3*self.m[2]*(self.m[1] + 3*self.m[2])*cq2**2 + 9*self.m[2]*(self.m[0] + self.m[1] + self.m[2])*cq12**2 + 3*(self.m[1] + 2*self.m[2])**2*cq1**2 - 4*(self.m[1] + 3*self.m[2])*(self.m[0] + self.m[1] + self.m[2]))), 3*(2*self.b[1]*self.l2*(4*self.m[0] + 4*self.m[1] + 3*self.m[2]*sq2**2 + self.m[2]) + 6*self.l1**2*self.l2*self.m[2]*(-(self.m[1] + 2*self.m[2])*cq1*cq2 + 2*(self.m[0] + self.m[1] + self.m[2])*cq12)*sq12*q[4] - self.l1*self.l2*(3*self.m[2]*cq12*cq2 - 2*(self.m[1] + 2*self.m[2])*cq1)*(2*self.l1*self.m[1]*sq1*q[4] + 4*self.l1*self.m[2]*sq1*q[4]))/(2*self.l1**2*self.l2*(-9*self.m[2]*(self.m[1] + 2*self.m[2])*cq12*cq1*cq2 + 3*self.m[2]*(self.m[1] + 3*self.m[2])*cq2**2 + 9*self.m[2]*(self.m[0] + self.m[1] + self.m[2])*cq12**2 + 3*(self.m[1] + 2*self.m[2])**2*cq1**2 - 4*(self.m[1] + 3*self.m[2])*(self.m[0] + self.m[1] + self.m[2]))), 3*(-6*self.b[2]*self.l1*(-(self.m[1] + 2*self.m[2])*cq1*cq2 + 2*(self.m[0] + self.m[1] + self.m[2])*cq12) - 2*self.l1*self.l2**2*self.m[2]*(3*self.m[2]*cq12*cq2 - 2*(self.m[1] + 2*self.m[2])*cq1)*sq2*q[5] + 2*self.l1*self.l2**2*self.m[2]*(4*self.m[0] + 4*self.m[1] + 3*self.m[2]*sq2**2 + self.m[2])*sq12*q[5])/(2*self.l1**2*self.l2*(-9*self.m[2]*(self.m[1] + 2*self.m[2])*cq12*cq1*cq2 + 3*self.m[2]*(self.m[1] + 3*self.m[2])*cq2**2 + 9*self.m[2]*(self.m[0] + self.m[1] + self.m[2])*cq12**2 + 3*(self.m[1] + 2*self.m[2])**2*cq1**2 - 4*(self.m[1] + 3*self.m[2])*(self.m[0] + self.m[1] + self.m[2])))],
                          [0, 3*(-self.l1*self.l2*self.m[2]*(3*(self.m[1] + 2*self.m[2])*cq12*cq1 - 2*(self.m[1] + 3*self.m[2])*cq2)*(-2*self.b[0]*q[3] + self.l1*self.m[1]*sq1*q[4]**2 + 2*self.l1*self.m[2]*sq1*q[4]**2 + self.l2*self.m[2]*sq2*q[5]**2 + 2*u) + self.l1*(-3*(self.m[1] + 2*self.m[2])**2*cq1**2 + 4*(self.m[1] + 3*self.m[2])*(self.m[0] + self.m[1] + self.m[2]))*(2*self.b[2]*q[5] + self.g*self.l2*self.m[2]*sq2 - self.l1*self.l2*self.m[2]*sq12*q[4]**2) - 3*self.l2*self.m[2]*(-(self.m[1] + 2*self.m[2])*cq1*cq2 + 2*(self.m[0] + self.m[1] + self.m[2])*cq12)*(2*self.b[1]*q[4] + self.g*self.l1*self.m[1]*sq1 + 2*self.g*self.l1*self.m[2]*sq1 + self.l1*self.l2*self.m[2]*sq12*q[5]**2))*(-9*self.m[2]*(self.m[1] + 2*self.m[2])*sq12*cq1*cq2 - 9*self.m[2]*(self.m[1] + 2*self.m[2])*sq1*cq12*cq2 + 18*self.m[2]*(self.m[0] + self.m[1] + self.m[2])*sq12*cq12 + 6*(self.m[1] + 2*self.m[2])**2*sq1*cq1)/(2*self.l1*self.l2**2*self.m[2]*(-9*self.m[2]*(self.m[1] + 2*self.m[2])*cq12*cq1*cq2 + 3*self.m[2]*(self.m[1] + 3*self.m[2])*cq2**2 + 9*self.m[2]*(self.m[0] + self.m[1] + self.m[2])*cq12**2 + 3*(self.m[1] + 2*self.m[2])**2*cq1**2 - 4*(self.m[1] + 3*self.m[2])*(self.m[0] + self.m[1] + self.m[2]))**2) + 3*(-self.l1**2*self.l2*self.m[2]*(-3*(self.m[1] + 2*self.m[2])**2*cq1**2 + 4*(self.m[1] + 3*self.m[2])*(self.m[0] + self.m[1] + self.m[2]))*cq12*q[4]**2 - self.l1*self.l2*self.m[2]*(-3*(self.m[1] + 2*self.m[2])*sq12*cq1 - 3*(self.m[1] + 2*self.m[2])*sq1*cq12)*(-2*self.b[0]*q[3] + self.l1*self.m[1]*sq1*q[4]**2 + 2*self.l1*self.m[2]*sq1*q[4]**2 + self.l2*self.m[2]*sq2*q[5]**2 + 2*u) - self.l1*self.l2*self.m[2]*(3*(self.m[1] + 2*self.m[2])*cq12*cq1 - 2*(self.m[1] + 3*self.m[2])*cq2)*(self.l1*self.m[1]*cq1*q[4]**2 + 2*self.l1*self.m[2]*cq1*q[4]**2) + 6*self.l1*(self.m[1] + 2*self.m[2])**2*(2*self.b[2]*q[5] + self.g*self.l2*self.m[2]*sq2 - self.l1*self.l2*self.m[2]*sq12*q[4]**2)*sq1*cq1 - 3*self.l2*self.m[2]*((self.m[1] + 2*self.m[2])*sq1*cq2 - 2*(self.m[0] + self.m[1] + self.m[2])*sq12)*(2*self.b[1]*q[4] + self.g*self.l1*self.m[1]*sq1 + 2*self.g*self.l1*self.m[2]*sq1 + self.l1*self.l2*self.m[2]*sq12*q[5]**2) - 3*self.l2*self.m[2]*(-(self.m[1] + 2*self.m[2])*cq1*cq2 + 2*(self.m[0] + self.m[1] + self.m[2])*cq12)*(self.g*self.l1*self.m[1]*cq1 + 2*self.g*self.l1*self.m[2]*cq1 + self.l1*self.l2*self.m[2]*cq12*q[5]**2))/(2*self.l1*self.l2**2*self.m[2]*(-9*self.m[2]*(self.m[1] + 2*self.m[2])*cq12*cq1*cq2 + 3*self.m[2]*(self.m[1] + 3*self.m[2])*cq2**2 + 9*self.m[2]*(self.m[0] + self.m[1] + self.m[2])*cq12**2 + 3*(self.m[1] + 2*self.m[2])**2*cq1**2 - 4*(self.m[1] + 3*self.m[2])*(self.m[0] + self.m[1] + self.m[2]))), 3*(-self.l1*self.l2*self.m[2]*(3*(self.m[1] + 2*self.m[2])*cq12*cq1 - 2*(self.m[1] + 3*self.m[2])*cq2)*(-2*self.b[0]*q[3] + self.l1*self.m[1]*sq1*q[4]**2 + 2*self.l1*self.m[2]*sq1*q[4]**2 + self.l2*self.m[2]*sq2*q[5]**2 + 2*u) + self.l1*(-3*(self.m[1] + 2*self.m[2])**2*cq1**2 + 4*(self.m[1] + 3*self.m[2])*(self.m[0] + self.m[1] + self.m[2]))*(2*self.b[2]*q[5] + self.g*self.l2*self.m[2]*sq2 - self.l1*self.l2*self.m[2]*sq12*q[4]**2) - 3*self.l2*self.m[2]*(-(self.m[1] + 2*self.m[2])*cq1*cq2 + 2*(self.m[0] + self.m[1] + self.m[2])*cq12)*(2*self.b[1]*q[4] + self.g*self.l1*self.m[1]*sq1 + 2*self.g*self.l1*self.m[2]*sq1 + self.l1*self.l2*self.m[2]*sq12*q[5]**2))*(9*self.m[2]*(self.m[1] + 2*self.m[2])*sq12*cq1*cq2 - 9*self.m[2]*(self.m[1] + 2*self.m[2])*sq2*cq12*cq1 + 6*self.m[2]*(self.m[1] + 3*self.m[2])*sq2*cq2 - 18*self.m[2]*(self.m[0] + self.m[1] + self.m[2])*sq12*cq12)/(2*self.l1*self.l2**2*self.m[2]*(-9*self.m[2]*(self.m[1] + 2*self.m[2])*cq12*cq1*cq2 + 3*self.m[2]*(self.m[1] + 3*self.m[2])*cq2**2 + 9*self.m[2]*(self.m[0] + self.m[1] + self.m[2])*cq12**2 + 3*(self.m[1] + 2*self.m[2])**2*cq1**2 - 4*(self.m[1] + 3*self.m[2])*(self.m[0] + self.m[1] + self.m[2]))**2) + 3*(-self.l1*self.l2**2*self.m[2]**2*(3*(self.m[1] + 2*self.m[2])*cq12*cq1 - 2*(self.m[1] + 3*self.m[2])*cq2)*cq2*q[5]**2 + 3*self.l1*self.l2**2*self.m[2]**2*(-(self.m[1] + 2*self.m[2])*cq1*cq2 + 2*(self.m[0] + self.m[1] + self.m[2])*cq12)*cq12*q[5]**2 - self.l1*self.l2*self.m[2]*(3*(self.m[1] + 2*self.m[2])*sq12*cq1 + 2*(self.m[1] + 3*self.m[2])*sq2)*(-2*self.b[0]*q[3] + self.l1*self.m[1]*sq1*q[4]**2 + 2*self.l1*self.m[2]*sq1*q[4]**2 + self.l2*self.m[2]*sq2*q[5]**2 + 2*u) + self.l1*(-3*(self.m[1] + 2*self.m[2])**2*cq1**2 + 4*(self.m[1] + 3*self.m[2])*(self.m[0] + self.m[1] + self.m[2]))*(self.g*self.l2*self.m[2]*cq2 + self.l1*self.l2*self.m[2]*cq12*q[4]**2) - 3*self.l2*self.m[2]*((self.m[1] + 2*self.m[2])*sq2*cq1 + 2*(self.m[0] + self.m[1] + self.m[2])*sq12)*(2*self.b[1]*q[4] + self.g*self.l1*self.m[1]*sq1 + 2*self.g*self.l1*self.m[2]*sq1 + self.l1*self.l2*self.m[2]*sq12*q[5]**2))/(2*self.l1*self.l2**2*self.m[2]*(-9*self.m[2]*(self.m[1] + 2*self.m[2])*cq12*cq1*cq2 + 3*self.m[2]*(self.m[1] + 3*self.m[2])*cq2**2 + 9*self.m[2]*(self.m[0] + self.m[1] + self.m[2])*cq12**2 + 3*(self.m[1] + 2*self.m[2])**2*cq1**2 - 4*(self.m[1] + 3*self.m[2])*(self.m[0] + self.m[1] + self.m[2]))), 3*self.b[0]*(3*(self.m[1] + 2*self.m[2])*cq12*cq1 - 2*(self.m[1] + 3*self.m[2])*cq2)/(self.l2*(-9*self.m[2]*(self.m[1] + 2*self.m[2])*cq12*cq1*cq2 + 3*self.m[2]*(self.m[1] + 3*self.m[2])*cq2**2 + 9*self.m[2]*(self.m[0] + self.m[1] + self.m[2])*cq12**2 + 3*(self.m[1] + 2*self.m[2])**2*cq1**2 - 4*(self.m[1] + 3*self.m[2])*(self.m[0] + self.m[1] + self.m[2]))), 3*(-6*self.b[1]*self.l2*self.m[2]*(-(self.m[1] + 2*self.m[2])*cq1*cq2 + 2*(self.m[0] + self.m[1] + self.m[2])*cq12) - 2*self.l1**2*self.l2*self.m[2]*(-3*(self.m[1] + 2*self.m[2])**2*cq1**2 + 4*(self.m[1] + 3*self.m[2])*(self.m[0] + self.m[1] + self.m[2]))*sq12*q[4] - self.l1*self.l2*self.m[2]*(3*(self.m[1] + 2*self.m[2])*cq12*cq1 - 2*(self.m[1] + 3*self.m[2])*cq2)*(2*self.l1*self.m[1]*sq1*q[4] + 4*self.l1*self.m[2]*sq1*q[4]))/(2*self.l1*self.l2**2*self.m[2]*(-9*self.m[2]*(self.m[1] + 2*self.m[2])*cq12*cq1*cq2 + 3*self.m[2]*(self.m[1] + 3*self.m[2])*cq2**2 + 9*self.m[2]*(self.m[0] + self.m[1] + self.m[2])*cq12**2 + 3*(self.m[1] + 2*self.m[2])**2*cq1**2 - 4*(self.m[1] + 3*self.m[2])*(self.m[0] + self.m[1] + self.m[2]))), 3*(2*self.b[2]*self.l1*(-3*(self.m[1] + 2*self.m[2])**2*cq1**2 + 4*(self.m[1] + 3*self.m[2])*(self.m[0] + self.m[1] + self.m[2])) - 2*self.l1*self.l2**2*self.m[2]**2*(3*(self.m[1] + 2*self.m[2])*cq12*cq1 - 2*(self.m[1] + 3*self.m[2])*cq2)*sq2*q[5] - 6*self.l1*self.l2**2*self.m[2]**2*(-(self.m[1] + 2*self.m[2])*cq1*cq2 + 2*(self.m[0] + self.m[1] + self.m[2])*cq12)*sq12*q[5])/(2*self.l1*self.l2**2*self.m[2]*(-9*self.m[2]*(self.m[1] + 2*self.m[2])*cq12*cq1*cq2 + 3*self.m[2]*(self.m[1] + 3*self.m[2])*cq2**2 + 9*self.m[2]*(self.m[0] + self.m[1] + self.m[2])*cq12**2 + 3*(self.m[1] + 2*self.m[2])**2*cq1**2 - 4*(self.m[1] + 3*self.m[2])*(self.m[0] + self.m[1] + self.m[2])))]]),
                np.array([[0], [0], [0], [(-4*self.m[1] + 9*self.m[2]*cq12**2 - 12*self.m[2])/(-9*self.m[2]*(self.m[1] + 2*self.m[2])*cq12*cq1*cq2 + 3*self.m[2]*(self.m[1] + 3*self.m[2])*cq2**2 + 9*self.m[2]*(self.m[0] + self.m[1] + self.m[2])*cq12**2 + 3*(self.m[1] + 2*self.m[2])**2*cq1**2 - 4*(self.m[1] + 3*self.m[2])*(self.m[0] + self.m[1] + self.m[2]))], [-3*(3*self.m[2]*cq12*cq2 - 2*(self.m[1] + 2*self.m[2])*cq1)/(self.l1*(-9*self.m[2]*(self.m[1] + 2*self.m[2])*cq12*cq1*cq2 + 3*self.m[2]*(self.m[1] + 3*self.m[2])*cq2**2 + 9*self.m[2]*(self.m[0] + self.m[1] + self.m[2])*cq12**2 + 3*(self.m[1] + 2*self.m[2])**2*cq1**2 - 4*(self.m[1] + 3*self.m[2])*(self.m[0] + self.m[1] + self.m[2])))], [-3*(3*(self.m[1] + 2*self.m[2])*cq12*cq1 - 2*(self.m[1] + 3*self.m[2])*cq2)/(self.l2*(-9*self.m[2]*(self.m[1] + 2*self.m[2])*cq12*cq1*cq2 + 3*self.m[2]*(self.m[1] + 3*self.m[2])*cq2**2 + 9*self.m[2]*(self.m[0] + self.m[1] + self.m[2])*cq12**2 + 3*(self.m[1] + 2*self.m[2])**2*cq1**2 - 4*(self.m[1] + 3*self.m[2])*(self.m[0] + self.m[1] + self.m[2])))]]))
end